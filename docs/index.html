<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=960, initial-scale=1.0" />
    <title>ズルいトゥイーンアニメーション</title>
    <link rel="stylesheet" href="styles.css" />
    <script type="importmap">
      {
        "imports": {
          "animejs": "https://cdn.jsdelivr.net/npm/animejs@4.1.3/+esm"
        }
      }
    </script>
    <script type="module">
      import { animate, createTimeline, utils } from "animejs";

      // move_01: 基本的な移動アニメーション
      function initMove01() {
        const container = document.getElementById("move_01");
        const dot1 = container.querySelector(".dot:nth-child(1)");
        const dot2 = container.querySelector(".dot:nth-child(2)");

        // 座標定義
        const positionFrom = { x: 100, y: 50 };
        const positionTo = { x: 520, y: 200 };

        // 初期位置
        utils.set([dot1, dot2], positionFrom);

        // アニメーション1: 同じイージング
        animate(dot1, {
          x: positionTo.x,
          y: positionTo.y,
          duration: 1000,
          ease: "inOutQuart",
          loop: true,
        });

        animate(dot2, {
          x: { to: positionTo.x, duration: 1000, ease: "inOutQuart" },
          y: { to: positionTo.y, duration: 1000, ease: "outBack" },
          loop: true,
        });
      }

      // move_02: スケール付き移動アニメーション
      function initMove02() {
        const container = document.getElementById("move_02");
        const dot1 = container.querySelector(".dot:nth-child(1)");
        const dot2 = container.querySelector(".dot:nth-child(2)");

        // 座標定義
        const positionFrom = { x: 0, y: 0 };
        const positionTo = { x: 260, y: 150 };
        const scaleFromValue = 0.1;
        const scaleToValue = 1;

        // 初期位置
        utils.set([dot1, dot2], positionFrom);
        utils.set([dot1, dot2], { scale: scaleFromValue });

        // アニメーション1: 同じイージング
        animate(dot1, {
          x: positionTo.x,
          y: positionTo.y,
          scale: scaleToValue,
          duration: 1000,
          ease: "inOutQuart",
          loop: true,
        });

        // アニメーション2: X座標
        animate(dot2, {
          x: { to: positionTo.x, duration: 1000, ease: "inOutQuart" },
          y: { to: positionTo.y, duration: 1000, ease: "outBack" },
          scale: { to: scaleToValue, duration: 1000, ease: "inOutQuart" },
          loop: true,
        });
      }

      // move_03: リニア移動アニメーション
      function initMove03() {
        const container = document.getElementById("move_03");
        const dot1 = container.querySelector(".dot:nth-child(1)");
        const dot2 = container.querySelector(".dot:nth-child(2)");

        // 座標定義
        const positionFrom = { x: 0, y: 0 };
        const positionTo = { x: 520, y: 200 };
        // アニメーション1: 同じイージング
        animate(dot1, {
          opacity: [0.3, 1],
          x: [positionFrom.x, positionTo.x],
          y: [positionFrom.y, positionTo.y],
          duration: 1000,
          ease: "inOutQuart",
          loop: true,
        });

        // アニメーション2: X座標
        const tl = createTimeline({ loop: true });
        tl.add(
          dot2,
          {
            x: [positionFrom.x, positionTo.x],
            duration: 1000,
            ease: "inOutQuart",
          },
          0
        );

        // アニメーション2: Y座標（linear）
        tl.add(
          dot2,
          {
            y: [positionFrom.y, positionTo.y],
            duration: 1000,
            ease: "linear",
          },
          0
        );

        tl.loop = true;
      }

      // expand: 伸縮アニメーション
      function initExpand() {
        const container = document.getElementById("expand");
        const dot1 = container.querySelector(".dot:nth-child(1)");
        const dot2 = container.querySelector(".dot:nth-child(2)");

        // 座標定義（開始点と終了点が同じ）
        const position1 = { x: 175, y: 150 };
        const position2 = { x: 450, y: 150 };
        const scaleFromValue = 0.3;
        const scaleToValue = 1;

        // 初期位置とスケールを設定
        dot1.style.left = position1.x + "px";
        dot1.style.top = position1.y + "px";
        dot1.style.transform = "scale(0.3)";
        dot2.style.left = position2.x + "px";
        dot2.style.top = position2.y + "px";
        dot2.style.transform = "scale(0.3)";

        // アニメーション1: 同時に再生
        animate(dot1, {
          scale: [scaleFromValue, scaleToValue],
          duration: 1000,
          ease: "outElastic",
          loop: true,
        });

        // アニメーション2: X方向のスケール
        const tl = createTimeline({ loop: true });
        tl.add(
          dot2,
          {
            scaleX: [scaleFromValue, scaleToValue],
            duration: 1000,
            ease: "outElastic",
          },
          0
        );

        // アニメーション2: Y方向のスケール（0.1秒ずらし）
        tl.add(
          dot2,
          {
            scaleY: [scaleFromValue, scaleToValue],
            duration: 1000,
            ease: "outElastic",
          },
          100
        );

        tl.loop = true;
      }

      // rotate: 回転アニメーション
      function initRotate() {
        const container = document.getElementById("rotate");
        const dot1 = container.querySelector(".dot:nth-child(1)");
        const dot2 = container.querySelector(".dot:nth-child(2)");

        // 座標定義
        const positionFrom1 = { x: 75, y: 125 };
        const positionTo1 = { x: 545, y: 125 };
        const positionFrom2 = { x: 75, y: 275 };
        const positionTo2 = { x: 545, y: 275 };

        // 初期位置を設定
        dot1.style.left = positionFrom1.x + "px";
        dot1.style.top = positionFrom1.y + "px";
        dot2.style.left = positionFrom2.x + "px";
        dot2.style.top = positionFrom2.y + "px";
        dot2.style.transformOrigin = "center";

        // アニメーション1: 横移動のみ
        animate(dot1, {
          x: [positionFrom1.x, positionTo1.x],
          duration: 600,
          ease: "inOutCirc",
          loop: true,
        });

        // アニメーション2: 横移動
        const tl = createTimeline({ loop: true });
        tl.add(dot2, {
          x: {
            to: positionTo2.x,
            duration: 600,
            ease: "inOutCirc",
          },
          rotate: [
            { to: 0 },
            { to: "-30deg", duration: 400, easing: "outCirc" },
            { to: "10deg", duration: 600, easing: "inOutCirc" },
            { to: 0, duration: 300, easing: "outBack" },
          ],
        });
      }

      // drop: 落下アニメーション
      function initDrop() {
        const container = document.getElementById("drop");
        const dot1 = container.querySelector(".dot:nth-child(1)");
        const dot2 = container.querySelector(".dot:nth-child(2)");

        // 座標定義
        const positionFrom1 = { x: 170, y: -100 };
        const positionTo1 = { x: 170, y: 300 };
        const positionFrom2 = { x: 420, y: -100 };
        const positionTo2 = { x: 420, y: 300 };
        const scaleFrom = { x: 0.2, y: 2 };
        const scaleTo = { x: 1, y: 1 };

        // 初期位置を設定
        dot1.style.left = positionFrom1.x + "px";
        dot1.style.top = positionFrom1.y + "px";
        dot2.style.left = positionFrom2.x + "px";
        dot2.style.top = positionFrom2.y + "px";
        dot2.style.transformOrigin = "center 100%";

        // アニメーション1: 落ちて跳ねる動きのみ
        animate(
          dot1,
          {
            y: [positionFrom1.y, positionTo1.y],
            duration: 1000,
            ease: "outBounce",
            loop: true,
          },
          500
        );

        const tl = createTimeline({ loop: true });
        // アニメーション2: 落ちて跳ねる動き
        tl.add(
          dot2,
          {
            y: [positionFrom2.y, positionTo2.y],
            duration: 1000,
            ease: "outBounce",
          },
          0
        );

        // アニメーション2: 伸縮の動き
        tl.add(
          dot2,
          {
            scaleX: [scaleFrom.x, scaleTo.x],
            scaleY: [scaleFrom.y, scaleTo.y],
            duration: 300,
            ease: "outBack(4)",
          },
          300
        );

        tl.loop = true;
      }

      // 初期化
      document.addEventListener("DOMContentLoaded", () => {
        // ハッシュで表示を切り替える
        let demoContainer;
        const hash = location.hash;

        if (hash.length) {
          demoContainer = document.getElementById(hash.substr(1, hash.length));
          demoContainer.hidden = false;
        } else {
          const containers = document.getElementsByClassName("demo-container");
          for (demoContainer of containers) {
            demoContainer.hidden = false;
          }
        }

        initMove01();
        initMove02();
        initMove03();
        initExpand();
        initRotate();
        initDrop();
      });
    </script>
  </head>
  <body>
    <div id="root">
      <div id="move_01" class="demo-container" hidden>
        <div class="dot dot-100 ghost"></div>
        <div class="dot dot-100"></div>
      </div>
      <div id="move_02" class="demo-container" hidden>
        <div class="dot dot-200 ghost"></div>
        <div class="dot dot-200"></div>
      </div>
      <div id="move_03" class="demo-container" hidden>
        <div class="dot dot-100 ghost"></div>
        <div class="dot dot-100"></div>
      </div>
      <div id="expand" class="demo-container" hidden>
        <div class="dot dot-200"></div>
        <div class="dot dot-200"></div>
        <p>拡大時に、垂直と水平のタイミングをずらす</p>
      </div>
      <div id="rotate" class="demo-container" hidden>
        <div class="dot dot-100 rotate"></div>
        <div class="dot dot-100 rotate"></div>
        <p>横移動に、回転の動作を加える</p>
      </div>
      <div id="drop" class="demo-container" hidden>
        <div class="dot dot-100"></div>
        <div class="dot dot-100"></div>
        <p>落ちて跳ねるときに、伸縮の動作を加える</p>
      </div>
    </div>

    <script></script>
  </body>
</html>
